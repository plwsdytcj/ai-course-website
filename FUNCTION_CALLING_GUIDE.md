# DeepSeek Function Calling é›†æˆæŒ‡å—

## ğŸ¯ ä»€ä¹ˆæ˜¯Function Callingï¼Ÿ

**ä¼ ç»Ÿæ–¹å¼ï¼ˆå…³é”®è¯åŒ¹é…ï¼‰ï¼š**
```javascript
if (userText === 'ä½™é¢') {
  // æŸ¥ä½™é¢
} else if (userText === 'å……å€¼') {
  // å……å€¼
}
```
âŒ é—®é¢˜ï¼šç”¨æˆ·å¿…é¡»è¯´å›ºå®šå…³é”®è¯

**Function Callingï¼ˆæ™ºèƒ½è·¯ç”±ï¼‰ï¼š**
```javascript
ç”¨æˆ·: "æˆ‘æƒ³çœ‹çœ‹æˆ‘è¿˜å‰©å¤šå°‘æ¬¡"  â† è‡ªç„¶è¯­è¨€
  â†“
LLMç†è§£: ç”¨æˆ·æƒ³æŸ¥ä½™é¢
  â†“
è°ƒç”¨: getUserBalance()
  â†“
è¿”å›: "æ‚¨è¿˜æœ‰50æ¬¡å¯¹è¯"
```
âœ… ä¼˜åŠ¿ï¼šç”¨æˆ·éšä¾¿æ€ä¹ˆè¯´éƒ½èƒ½ç†è§£

---

## ğŸ”¥ å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·: "å¸®æˆ‘çœ‹ä¸‹æˆ‘çš„ä½™é¢"                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DeepSeek AI åˆ†ææ„å›¾                    â”‚
â”‚  åˆ¤æ–­: è¿™æ˜¯æŸ¥è¯¢ä½™é¢çš„è¯·æ±‚               â”‚
â”‚  å†³å®šè°ƒç”¨: getUserBalance()             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰§è¡Œå‡½æ•°                                â”‚
â”‚  getUserBalance(openId)                 â”‚
â”‚  è¿”å›: { credits: 50, messageCount: 10 }â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DeepSeek AI ç”Ÿæˆå›å¤                    â”‚
â”‚  "æ‚¨å½“å‰æœ‰50æ¬¡å¯¹è¯æœºä¼šï¼Œå·²ç´¯è®¡å¯¹è¯10æ¬¡" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ å¯ç”¨çš„å‡½æ•°

### 1ï¸âƒ£ getUserBalance - æŸ¥è¯¢ä½™é¢

**è§¦å‘åœºæ™¯ï¼š**
- "æˆ‘è¿˜æœ‰å¤šå°‘æ¬¡"
- "æŸ¥ä½™é¢"
- "è¿˜å‰©å‡ æ¬¡å¯¹è¯"
- "æˆ‘çš„è´¦æˆ·"

**è¿”å›ï¼š**
```json
{
  "credits": 50,
  "messageCount": 10
}
```

---

### 2ï¸âƒ£ createRechargeOrder - åˆ›å»ºå……å€¼è®¢å•

**è§¦å‘åœºæ™¯ï¼š**
- "æˆ‘è¦å……å€¼"
- "ä¹°50æ¬¡å¯¹è¯"
- "å……1å—é’±"
- "è´­ä¹°å¥—é¤"

**å‚æ•°ï¼š**
- `package`: '1' | '5' | '10'

**è¿”å›ï¼š**
```json
{
  "orderNo": "ORDER123456",
  "amount": 1,
  "credits": 50,
  "payUrl": "https://..."
}
```

---

### 3ï¸âƒ£ getRechargePackages - æŸ¥è¯¢å……å€¼å¥—é¤

**è§¦å‘åœºæ™¯ï¼š**
- "æœ‰å“ªäº›å……å€¼å¥—é¤"
- "å¤šå°‘é’±"
- "ä»·æ ¼è¡¨"

**è¿”å›ï¼š**
```json
{
  "packages": [
    { "id": "1", "price": 1, "credits": 50, "desc": "1å…ƒ50æ¬¡" },
    { "id": "5", "price": 5, "credits": 300, "desc": "5å…ƒ300æ¬¡" },
    { "id": "10", "price": 10, "credits": 700, "desc": "10å…ƒ700æ¬¡" }
  ]
}
```

---

### 4ï¸âƒ£ getPaymentHistory - æŸ¥è¯¢å……å€¼å†å²

**è§¦å‘åœºæ™¯ï¼š**
- "æˆ‘çš„å……å€¼è®°å½•"
- "å†å²è®¢å•"
- "ä¹‹å‰ä¹°äº†å‡ æ¬¡"

**è¿”å›ï¼š**
```json
{
  "history": [
    { "orderNo": "...", "amount": 1, "credits": 50, "time": "..." }
  ]
}
```

---

## ğŸ”§ å¦‚ä½•é›†æˆåˆ°server/index.js

### æ–¹æ³•1ï¼šæ›¿æ¢ç°æœ‰AIè°ƒç”¨

**æ‰¾åˆ°ç°æœ‰ä»£ç ï¼š**
```javascript
// server/index.js ç¬¬568è¡Œå·¦å³
replyContent = await handleTextMessage(userText);
```

**æ›¿æ¢ä¸ºï¼š**
```javascript
import { callDeepSeekWithTools } from './server/function-calling.js';

// åˆ›å»ºcontext
const context = {
  openId: userOpenId,
  getUserData: getUserData,
  createWxPayOrder: createWxPayOrder
};

// è°ƒç”¨æ”¯æŒFunction Callingçš„AI
replyContent = await callDeepSeekWithTools(userText, context);
```

---

### æ–¹æ³•2ï¼šä¿ç•™å…³é”®è¯ï¼ŒAIä½œä¸ºè¡¥å……

```javascript
if (userText === 'ä½™é¢' || userText === 'æŸ¥è¯¢ä½™é¢') {
  // å¿«é€Ÿå“åº”ï¼ˆä¸è°ƒç”¨AIï¼‰
  userData = userData || getUserData(userOpenId);
  replyContent = `ğŸ’³ æ‚¨çš„ä½™é¢\n\nå‰©ä½™æ¬¡æ•°ï¼š${userData.credits}æ¬¡`;
  
} else {
  // å…¶ä»–æƒ…å†µä½¿ç”¨AI + Function Calling
  const context = { openId: userOpenId, getUserData, createWxPayOrder };
  replyContent = await callDeepSeekWithTools(userText, context);
}
```

---

## ğŸ’¡ å¯¹è¯ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæŸ¥ä½™é¢

```
ç”¨æˆ·: "æˆ‘æƒ³çœ‹çœ‹æˆ‘è¿˜å‰©å¤šå°‘æ¬¡å¯¹è¯"

AIå†…éƒ¨:
1. ç†è§£æ„å›¾ï¼šæŸ¥è¯¢ä½™é¢
2. è°ƒç”¨ï¼šgetUserBalance()
3. è·å–æ•°æ®ï¼š{ credits: 50, messageCount: 10 }
4. ç”Ÿæˆå›å¤

AIå›å¤: "æ‚¨å½“å‰è¿˜æœ‰50æ¬¡å¯¹è¯æœºä¼šï¼Œå·²ç´¯è®¡ä½¿ç”¨10æ¬¡ã€‚"
```

---

### ç¤ºä¾‹2ï¼šæ™ºèƒ½å……å€¼

```
ç”¨æˆ·: "æˆ‘æƒ³ä¹°ç‚¹å¯¹è¯æ¬¡æ•°"

AIå†…éƒ¨:
1. ç†è§£æ„å›¾ï¼šæƒ³è¦å……å€¼
2. è°ƒç”¨ï¼šgetRechargePackages()
3. è·å–å¥—é¤åˆ—è¡¨
4. ç”Ÿæˆå›å¤

AIå›å¤: "æˆ‘ä»¬æœ‰ä»¥ä¸‹å……å€¼å¥—é¤ï¼š
1. 1å…ƒ50æ¬¡ - æœ€å®æƒ 
2. 5å…ƒ300æ¬¡ - é€50æ¬¡
3. 10å…ƒ700æ¬¡ - é€200æ¬¡
è¯·å‘Šè¯‰æˆ‘æ‚¨æƒ³é€‰æ‹©å“ªä¸ªå¥—é¤ï¼Ÿ"

ç”¨æˆ·: "æˆ‘è¦1å…ƒçš„"

AIå†…éƒ¨:
1. ç†è§£æ„å›¾ï¼šé€‰æ‹©1å…ƒå¥—é¤
2. è°ƒç”¨ï¼šcreateRechargeOrder({ package: '1' })
3. ç”Ÿæˆè®¢å•
4. ç”Ÿæˆå›å¤

AIå›å¤: "å¥½çš„ï¼å·²ä¸ºæ‚¨åˆ›å»ºå……å€¼è®¢å•ï¼š
é‡‘é¢ï¼š1å…ƒ
æ¬¡æ•°ï¼š50æ¬¡
è®¢å•å·ï¼šORDER123456
è¯·ç‚¹å‡»é“¾æ¥å®Œæˆæ”¯ä»˜ï¼š[é“¾æ¥]"
```

---

### ç¤ºä¾‹3ï¼šå¤šè½®å¯¹è¯

```
ç”¨æˆ·: "æˆ‘çš„è´¦æˆ·"

AI: "æ‚¨çš„è´¦æˆ·ä¿¡æ¯ï¼š
å‰©ä½™æ¬¡æ•°ï¼š5æ¬¡
ç´¯è®¡å¯¹è¯ï¼š45æ¬¡
çœ‹èµ·æ¥æ‚¨çš„æ¬¡æ•°å¿«ç”¨å®Œäº†ï¼Œéœ€è¦å……å€¼å—ï¼Ÿ"

ç”¨æˆ·: "å—¯å¥½çš„"

AIå†…éƒ¨: ç†è§£ä¸ºåŒæ„å……å€¼
AI: "å¥½çš„ï¼æˆ‘ä»¬æœ‰ä»¥ä¸‹å¥—é¤ï¼š
1. 1å…ƒ50æ¬¡
2. 5å…ƒ300æ¬¡
3. 10å…ƒ700æ¬¡
è¯·é€‰æ‹©ï¼Ÿ"

ç”¨æˆ·: "1å—é’±çš„"

AIå†…éƒ¨: åˆ›å»ºè®¢å•
AI: "è®¢å•å·²åˆ›å»ºï¼Œè¯·æ”¯ä»˜ï¼š[é“¾æ¥]"
```

---

## ğŸ¯ ä¼˜åŠ¿å¯¹æ¯”

### ä¼ ç»Ÿå…³é”®è¯æ–¹å¼

```javascript
âœ… å“åº”å¿«
âœ… ç®€å•
âŒ å¿…é¡»è¯´å›ºå®šè¯
âŒ ä¸çµæ´»
âŒ éœ€è¦å¤§é‡if-else

ç”¨æˆ·å¿…é¡»è¯´: "ä½™é¢"ã€"å……å€¼"
å¦‚æœè¯´: "è¿˜å‰©å‡ æ¬¡" â†’ æ— æ³•è¯†åˆ«
```

---

### Function Callingæ–¹å¼

```javascript
âœ… è‡ªç„¶è¯­è¨€ç†è§£
âœ… çµæ´»
âœ… æ˜“æ‰©å±•
âœ… ä»£ç ç®€æ´
âš ï¸ ç¨æ…¢ï¼ˆéœ€è¦AIåˆ¤æ–­ï¼‰

ç”¨æˆ·å¯ä»¥è¯´:
- "ä½™é¢"
- "è¿˜å‰©å‡ æ¬¡"
- "æˆ‘æƒ³çœ‹çœ‹æˆ‘çš„è´¦æˆ·"
- "å¸®æˆ‘æŸ¥ä¸€ä¸‹æ¬¡æ•°"
éƒ½èƒ½ç†è§£ï¼âœ…
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1ï¼šå¤åˆ¶æ–‡ä»¶

```bash
# æ–‡ä»¶å·²åˆ›å»º
server/function-calling.js  âœ…
```

---

### æ­¥éª¤2ï¼šæµ‹è¯•Function Calling

åˆ›å»ºæµ‹è¯•è„šæœ¬ï¼š

```javascript
import { callDeepSeekWithTools } from './server/function-calling.js';

const context = {
  openId: 'test_user',
  getUserData: (id) => ({ credits: 50, messageCount: 10 }),
  createWxPayOrder: async (id, pkg) => ({ 
    orderNo: 'TEST123', 
    amount: 100, 
    credits: 50 
  })
};

// æµ‹è¯•
const reply = await callDeepSeekWithTools('æˆ‘è¿˜æœ‰å¤šå°‘æ¬¡å¯¹è¯', context);
console.log(reply);
```

---

### æ­¥éª¤3ï¼šé›†æˆåˆ°server/index.js

æ‰¾åˆ°å¤„ç†æ–‡æœ¬æ¶ˆæ¯çš„åœ°æ–¹ï¼Œæ›¿æ¢AIè°ƒç”¨ï¼š

```javascript
// å¯¼å…¥
import { callDeepSeekWithTools } from './server/function-calling.js';

// åœ¨å¤„ç†æ–‡æœ¬æ¶ˆæ¯æ—¶
const context = {
  openId: userOpenId,
  getUserData: getUserData,
  createWxPayOrder: createWxPayOrder
};

replyContent = await callDeepSeekWithTools(userText, context);
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ–¹å¼ | å“åº”æ—¶é—´ | å‡†ç¡®ç‡ | å¯æ‰©å±•æ€§ |
|------|---------|--------|---------|
| **å…³é”®è¯** | 10ms | 90% | â­â­ |
| **Function Calling** | 2-4ç§’ | 98% | â­â­â­â­â­ |

---

## ğŸ’° æˆæœ¬

```
æ¯æ¬¡è°ƒç”¨Function Calling:
- ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼šåˆ¤æ–­æ„å›¾ + é€‰æ‹©å‡½æ•°
- ç¬¬äºŒæ¬¡è°ƒç”¨ï¼šç”Ÿæˆæœ€ç»ˆå›å¤

æ€»å…±2æ¬¡APIè°ƒç”¨
æˆæœ¬ï¼š~0.002å…ƒ/æ¬¡

å¦‚æœç”¨æˆ·é‡å¤§ï¼š
- ç®€å•æŸ¥è¯¢ï¼ˆä½™é¢ï¼‰â†’ ç”¨å…³é”®è¯å¿«é€Ÿå“åº”
- å¤æ‚å¯¹è¯ â†’ ç”¨Function Calling
```

---

## ğŸ¯ æ¨èæ¶æ„

```javascript
// æ··åˆæ¨¡å¼ï¼ˆæœ€ä½³ï¼‰
if (userText === 'ä½™é¢' || userText === 'æŸ¥è¯¢ä½™é¢') {
  // å¿«é€Ÿé€šé“ï¼šå…³é”®è¯ç›´æ¥å“åº”
  replyContent = `å‰©ä½™ï¼š${credits}æ¬¡`;
  
} else {
  // æ™ºèƒ½é€šé“ï¼šFunction Calling
  const context = { ... };
  replyContent = await callDeepSeekWithTools(userText, context);
}
```

**ä¼˜åŠ¿ï¼š**
- âœ… å¸¸ç”¨åŠŸèƒ½å¿«é€Ÿå“åº”
- âœ… å…¶ä»–æƒ…å†µæ™ºèƒ½ç†è§£
- âœ… æˆæœ¬å¯æ§
- âœ… ä½“éªŒæœ€ä½³

---

## ğŸ”® æ‰©å±•ç¤ºä¾‹

### æ·»åŠ æ–°åŠŸèƒ½ï¼šæŸ¥è¯¢è¯¾ç¨‹

```javascript
// åœ¨availableFunctionsä¸­æ·»åŠ 
getCourseInfo: {
  name: 'getCourseInfo',
  description: 'æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯',
  parameters: {
    type: 'object',
    properties: {
      courseId: {
        type: 'string',
        description: 'è¯¾ç¨‹ID'
      }
    },
    required: []
  },
  handler: async (args, context) => {
    // æŸ¥è¯¢è¯¾ç¨‹é€»è¾‘
    return {
      courseName: 'AIè¯¾ç¨‹',
      teacher: 'å¼ è€å¸ˆ',
      students: 100
    };
  }
}
```

**å°±è¿™ä¹ˆç®€å•ï¼AIä¼šè‡ªåŠ¨å­¦ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼**

---

## ğŸ“š å‚è€ƒ

- **DeepSeekæ–‡æ¡£**: https://platform.deepseek.com/docs
- **Function Calling**: https://platform.deepseek.com/api-docs/function-calling
- **OpenAIå…¼å®¹**: DeepSeekå…¼å®¹OpenAIçš„Function Callingæ ¼å¼

---

## ğŸ‰ æ€»ç»“

**Function Calling = ç»™AIè£…ä¸Šæ‰‹å’Œè„š**

ä¹‹å‰ï¼šAIåªèƒ½è¯´è¯
ç°åœ¨ï¼šAIèƒ½è°ƒç”¨å·¥å…·ã€æŸ¥æ•°æ®ã€æ‰§è¡Œæ“ä½œ

**è¿™æ˜¯ç°ä»£AIåº”ç”¨çš„æ ‡å‡†æ¶æ„ï¼** ğŸš€

éœ€è¦æˆ‘å¸®æ‚¨é›†æˆåˆ°ç°æœ‰ä»£ç ä¸­å—ï¼Ÿ

